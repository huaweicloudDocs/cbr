# 示例2：创建存储库自动备份<a name="cbr_04_0027"></a>

## 场景描述<a name="section19271555175819"></a>

本章节指导用户通过策略接口，设置备份策略，绑定策略到存储库实现自动备份。

## 涉及接口<a name="section1685112323595"></a>

-   [创建策略](https://support.huaweicloud.com/api-cbr/CreatePolicy.html)：创建执行备份的周期。
-   [设置存储库策略](https://support.huaweicloud.com/api-cbr/AssociateVaultPolicy.html)：关联待设置的策略到存储库。

## 操作步骤<a name="section16202650195915"></a>

1.  创建策略。
    -   接口相关信息

        URI格式：POST /v3/\{project\_id\}/policies

        详情请参见：[创建策略](https://support.huaweicloud.com/api-cbr/CreatePolicy.html)  。

    -   请求示例

        POST: https://_\{endpoint_\}/v3/0605767b5780d5762fc5c0118072a564/policies

        \{endpoint\}信息请从[地区和终端节点](https://developer.huaweicloud.com/endpoint?CBR)获取。

        Body:

        ```
        {
            "policy": {
                "name": "dh_test_policy",
                "trigger": {
                    "properties": {
                        "pattern": ["FREQ=WEEKLY;BYDAY=SU,MO,TU,WE,TH,FR,SA;BYHOUR=23;BYMINUTE=00"]
        }
                },
                "operation_definition": {
                    "retention_duration_days": 30
        }
            }
        }
        ```

    -   响应示例

        ```
        {
            "policy": {
                "id": "30d7cf2d-14fc-415b-b7da-858b37f47250",
                "name": "dh_test_policy",
                "operation_type": "backup",
                "operation_definition": {
                    "retention_duration_days": 30
                },
                "enabled": true,
                "trigger": {
                    "id": "7954175b-ef2c-432c-b936-f6c83df7a593",
                    "name": "default",
                    "type": "time",
                    "properties": {
                        "pattern": [
                            "FREQ=WEEKLY;BYDAY=SU,MO,TU,WE,TH,FR,SA;BYHOUR=23;BYMINUTE=00"
                        ],
                        "start_time": "2020-08-17 08:39:44"
                    }
                },
                "associated_vaults": null
            }
        }
        ```

2.  设置存储库策略。
    -   接口相关信息

        POST /v3/\{project\_id\}/vaults/\{vault\_id\}/associatepolicy

        详情请参见[设置存储库策略](https://support.huaweicloud.com/api-cbr/AssociateVaultPolicy.html)。

    -   请求示例

        POST: https://\{endpoint\}/v3/0605767b5780d5762fc5c0118072a564 /vaults/ea7b8717-2543-478a-a92d-3ca7ee448f67/associatepolicy

        \{endpoint\}信息请从[地区和终端节点](https://developer.huaweicloud.com/endpoint?CBR)获取。

        Body:

        ```
        {
            "policy_id": "30d7cf2d-14fc-415b-b7da-858b37f47250"
        }
        ```

    -   响应示例

        ```
        {
            "associate_policy": {
                "vault_id": "ea7b8717-2543-478a-a92d-3ca7ee448f67",
                "policy_id": "30d7cf2d-14fc-415b-b7da-858b37f47250"
            }
        }
        ```



