# 什么是数据库服务器备份<a name="cbr_03_0109"></a>

## 数据库服务器备份简介<a name="section1617211139304"></a>

业界对备份一致性的定义包括如下三类：

-   不一致备份：备份的文件、磁盘不在同一个时间点。云备份中的云服务器备份提供对弹性云服务器和裸金属服务器的基于多云硬盘一致性快照技术的数据保护。如果使用云硬盘备份进行多个磁盘单独备份，多个磁盘由于备份时间点不一致，会出现不一致备份。
-   崩溃一致性备份：崩溃一致性备份会捕获备份时磁盘上已存在的数据，文件或磁盘数据在同一时间点，但不会备份内存数据并且静默应用系统，不保证应用系统备份一致性。尽管并未保证应用一致性，但通常情况下，操作系统重启后会进行**chkdsk**等磁盘检查过程来修复各种损坏错误，数据库会进行日志回滚操作保证一致性。
-   应用一致性备份：文件或磁盘数据在同一时间点，并备份内存数据，保证应用系统一致性。

三种不同的备份具体如[图1](#fig865855818567)所示。

云备份同时支持崩溃一致性备份和应用一致性备份（即数据库服务器备份）。下文均将应用一致性备份称为数据库服务器备份。

当云服务器部署MySQL或SAP HANA等数据库，通过云备份的数据库服务器备份功能，可完成对云服务器数据及应用缓存的备份。崩溃一致性备份在不停机期间仅能完成对数据和部分应用缓存的备份。在发生系统故障、数据丢失的事件时，使用数据库服务器备份，即可快速重启业务。而使用崩溃一致性备份可能会出现部分应用配置恢复不完全的情况。

**图 1**  备份一致性<a name="fig865855818567"></a>  
![](figures/备份一致性.png "备份一致性")

## 数据库服务器备份与云服务器备份、应用备份的区别<a name="section158804186318"></a>

<a name="table1965919985417"></a>
<table><thead align="left"><tr id="row76591917540"><th class="cellrowborder" valign="top" width="12.968703129687032%" id="mcps1.1.5.1.1"><p id="p5659792540"><a name="p5659792540"></a><a name="p5659792540"></a>对比维度</p>
</th>
<th class="cellrowborder" valign="top" width="28.22717728227177%" id="mcps1.1.5.1.2"><p id="p11659209155417"><a name="p11659209155417"></a><a name="p11659209155417"></a>数据库服务器备份</p>
</th>
<th class="cellrowborder" valign="top" width="29.99700029997%" id="mcps1.1.5.1.3"><p id="p1571719166545"><a name="p1571719166545"></a><a name="p1571719166545"></a>服务器备份</p>
</th>
<th class="cellrowborder" valign="top" width="28.8071192880712%" id="mcps1.1.5.1.4"><p id="p116609917545"><a name="p116609917545"></a><a name="p116609917545"></a>应用备份中的数据库备份（受限公测）</p>
</th>
</tr>
</thead>
<tbody><tr id="row66600985420"><td class="cellrowborder" valign="top" width="12.968703129687032%" headers="mcps1.1.5.1.1 "><p id="p766009155410"><a name="p766009155410"></a><a name="p766009155410"></a>备份/恢复对象</p>
</td>
<td class="cellrowborder" valign="top" width="28.22717728227177%" headers="mcps1.1.5.1.2 "><p id="p20549181333411"><a name="p20549181333411"></a><a name="p20549181333411"></a>部署MySQL或SAP HANA等数据库应用的云服务器</p>
</td>
<td class="cellrowborder" valign="top" width="29.99700029997%" headers="mcps1.1.5.1.3 "><p id="p20718716125418"><a name="p20718716125418"></a><a name="p20718716125418"></a>不包含数据库等应用的云服务器</p>
</td>
<td class="cellrowborder" valign="top" width="28.8071192880712%" headers="mcps1.1.5.1.4 "><p id="p8548131333413"><a name="p8548131333413"></a><a name="p8548131333413"></a>用户数据中心虚拟机或服务器中的数据库应用</p>
</td>
</tr>
<tr id="row15757040210"><td class="cellrowborder" valign="top" width="12.968703129687032%" headers="mcps1.1.5.1.1 "><p id="p197576417215"><a name="p197576417215"></a><a name="p197576417215"></a>备份粒度</p>
</td>
<td class="cellrowborder" valign="top" width="28.22717728227177%" headers="mcps1.1.5.1.2 "><p id="p1375764925"><a name="p1375764925"></a><a name="p1375764925"></a>云服务器</p>
</td>
<td class="cellrowborder" valign="top" width="29.99700029997%" headers="mcps1.1.5.1.3 "><p id="p11757541226"><a name="p11757541226"></a><a name="p11757541226"></a>云服务器</p>
</td>
<td class="cellrowborder" valign="top" width="28.8071192880712%" headers="mcps1.1.5.1.4 "><p id="p14757741824"><a name="p14757741824"></a><a name="p14757741824"></a>数据库</p>
</td>
</tr>
<tr id="row8127202883018"><td class="cellrowborder" valign="top" width="12.968703129687032%" headers="mcps1.1.5.1.1 "><p id="p181288282301"><a name="p181288282301"></a><a name="p181288282301"></a>存储库类型</p>
</td>
<td class="cellrowborder" valign="top" width="28.22717728227177%" headers="mcps1.1.5.1.2 "><p id="p1612882818307"><a name="p1612882818307"></a><a name="p1612882818307"></a>云服务器备份存储库</p>
</td>
<td class="cellrowborder" valign="top" width="29.99700029997%" headers="mcps1.1.5.1.3 "><p id="p71284289302"><a name="p71284289302"></a><a name="p71284289302"></a>云服务器备份存储库</p>
</td>
<td class="cellrowborder" valign="top" width="28.8071192880712%" headers="mcps1.1.5.1.4 "><p id="p1512812815305"><a name="p1512812815305"></a><a name="p1512812815305"></a>数据库备份存储库</p>
</td>
</tr>
<tr id="row96601391546"><td class="cellrowborder" valign="top" width="12.968703129687032%" headers="mcps1.1.5.1.1 "><p id="p186600918548"><a name="p186600918548"></a><a name="p186600918548"></a>推荐场景</p>
</td>
<td class="cellrowborder" valign="top" width="28.22717728227177%" headers="mcps1.1.5.1.2 "><p id="p9547151314345"><a name="p9547151314345"></a><a name="p9547151314345"></a>云服务器部署了MySQL或SAP HANA等数据库，需要对包含数据库的云服务器进行备份。恢复时能够恢复全部的数据和应用配置。</p>
</td>
<td class="cellrowborder" valign="top" width="29.99700029997%" headers="mcps1.1.5.1.3 "><p id="p17718141611548"><a name="p17718141611548"></a><a name="p17718141611548"></a>云服务器不包含数据库等应用，只需要对数据进行备份。恢复时能够恢复全部的数据。</p>
<p id="p56578335713"><a name="p56578335713"></a><a name="p56578335713"></a>如果包含MySQL或SAP HANA等数据库的云服务器只进行服务器备份，恢复时可能会出现部分应用配置恢复不完全，重新启用应用时可能会出现问题等情况。</p>
</td>
<td class="cellrowborder" valign="top" width="28.8071192880712%" headers="mcps1.1.5.1.4 "><p id="p7660233925"><a name="p7660233925"></a><a name="p7660233925"></a>需要对用户数据中心虚拟机或服务器中的数据库应用进行单独备份，能够在云上进行备份和恢复。</p>
<p id="p0546213103411"><a name="p0546213103411"></a><a name="p0546213103411"></a>暂时不支持单独对云上服务器的数据库进行备份。</p>
</td>
</tr>
</tbody>
</table>

## 适用范围<a name="section159113453712"></a>

支持安装Agent进行数据库服务器备份的操作系统如[表1](#table18922541392)所示。

**表 1**  支持安装客户端的操作系统列表

<a name="table18922541392"></a>
<table><thead align="left"><tr id="cbr_03_0021_row17963824406"><th class="cellrowborder" valign="top" width="19%" id="mcps1.2.4.1.1"><p id="cbr_03_0021_p69631254015"><a name="cbr_03_0021_p69631254015"></a><a name="cbr_03_0021_p69631254015"></a>数据库名称</p>
</th>
<th class="cellrowborder" valign="top" width="16%" id="mcps1.2.4.1.2"><p id="cbr_03_0021_p16963229402"><a name="cbr_03_0021_p16963229402"></a><a name="cbr_03_0021_p16963229402"></a>操作系统类型</p>
</th>
<th class="cellrowborder" valign="top" width="65%" id="mcps1.2.4.1.3"><p id="cbr_03_0021_p1596372134014"><a name="cbr_03_0021_p1596372134014"></a><a name="cbr_03_0021_p1596372134014"></a>版本范围</p>
</th>
</tr>
</thead>
<tbody><tr id="cbr_03_0021_row89794274012"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.2.4.1.1 "><p id="cbr_03_0021_p59631620403"><a name="cbr_03_0021_p59631620403"></a><a name="cbr_03_0021_p59631620403"></a>SQLServer 2008/2012</p>
</td>
<td class="cellrowborder" valign="top" width="16%" headers="mcps1.2.4.1.2 "><p id="cbr_03_0021_p20963420405"><a name="cbr_03_0021_p20963420405"></a><a name="cbr_03_0021_p20963420405"></a>Windows</p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.2.4.1.3 "><p id="cbr_03_0021_p39633217408"><a name="cbr_03_0021_p39633217408"></a><a name="cbr_03_0021_p39633217408"></a>Windows Server 2008, 2008 R2, 2012, 2012 R2 for x86_64</p>
</td>
</tr>
<tr id="cbr_03_0021_row129799211400"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.2.4.1.1 "><p id="cbr_03_0021_p109791629407"><a name="cbr_03_0021_p109791629407"></a><a name="cbr_03_0021_p109791629407"></a>SQLServer 2014/2016/EE</p>
</td>
<td class="cellrowborder" valign="top" width="16%" headers="mcps1.2.4.1.2 "><p id="cbr_03_0021_p139794217407"><a name="cbr_03_0021_p139794217407"></a><a name="cbr_03_0021_p139794217407"></a>Windows</p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.2.4.1.3 "><p id="cbr_03_0021_p102273139182"><a name="cbr_03_0021_p102273139182"></a><a name="cbr_03_0021_p102273139182"></a>Windows Server 2012, 2012 R2, 2016 Datacenter for x86_64</p>
</td>
</tr>
<tr id="cbr_03_0021_row397920294015"><td class="cellrowborder" rowspan="4" valign="top" width="19%" headers="mcps1.2.4.1.1 "><p id="cbr_03_0021_p49796244012"><a name="cbr_03_0021_p49796244012"></a><a name="cbr_03_0021_p49796244012"></a>MySQL 5.5/5.6/5.7</p>
</td>
<td class="cellrowborder" valign="top" width="16%" headers="mcps1.2.4.1.2 "><p id="cbr_03_0021_p79791323404"><a name="cbr_03_0021_p79791323404"></a><a name="cbr_03_0021_p79791323404"></a>Red Hat</p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.2.4.1.3 "><p id="cbr_03_0021_p19791827406"><a name="cbr_03_0021_p19791827406"></a><a name="cbr_03_0021_p19791827406"></a>Red Hat Enterprise Linux 6, 7 for x86_64</p>
</td>
</tr>
<tr id="cbr_03_0021_row189792264012"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="cbr_03_0021_p20979152134011"><a name="cbr_03_0021_p20979152134011"></a><a name="cbr_03_0021_p20979152134011"></a>SUSE</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="cbr_03_0021_p1375648143615"><a name="cbr_03_0021_p1375648143615"></a><a name="cbr_03_0021_p1375648143615"></a>SUSE Linux Enterprise Server 11, 12, 15 SP1, 15 SP2 for x86_64</p>
</td>
</tr>
<tr id="cbr_03_0021_row097919254017"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="cbr_03_0021_p3979172144013"><a name="cbr_03_0021_p3979172144013"></a><a name="cbr_03_0021_p3979172144013"></a>CentOS</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="cbr_03_0021_p3979722409"><a name="cbr_03_0021_p3979722409"></a><a name="cbr_03_0021_p3979722409"></a>CentOS 6, 7 for x86_64</p>
</td>
</tr>
<tr id="cbr_03_0021_row197918220402"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="cbr_03_0021_p209790216406"><a name="cbr_03_0021_p209790216406"></a><a name="cbr_03_0021_p209790216406"></a>Euler</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="cbr_03_0021_p139791820408"><a name="cbr_03_0021_p139791820408"></a><a name="cbr_03_0021_p139791820408"></a>Euler OS 2.2, 2.3 for x86_64</p>
</td>
</tr>
<tr id="cbr_03_0021_row18979422401"><td class="cellrowborder" valign="top" width="19%" headers="mcps1.2.4.1.1 "><p id="cbr_03_0021_p997910234020"><a name="cbr_03_0021_p997910234020"></a><a name="cbr_03_0021_p997910234020"></a>HANA 1.0/2.0</p>
</td>
<td class="cellrowborder" valign="top" width="16%" headers="mcps1.2.4.1.2 "><p id="cbr_03_0021_p1797910214408"><a name="cbr_03_0021_p1797910214408"></a><a name="cbr_03_0021_p1797910214408"></a>SUSE</p>
</td>
<td class="cellrowborder" valign="top" width="65%" headers="mcps1.2.4.1.3 "><p id="cbr_03_0021_p297916274013"><a name="cbr_03_0021_p297916274013"></a><a name="cbr_03_0021_p297916274013"></a>SUSE Linux Enterprise Server 12 for x86_64</p>
</td>
</tr>
</tbody>
</table>

兼容性列表以外的数据库，可以参考《云备份最佳实践》的“通过自定义脚本实现其它Linux应用的一致性备份”进行制作自定义脚本完成数据库服务器备份。

## 操作流程<a name="section4122010328"></a>

云备份数据库备份的主要流程如[图2](#fig3947184273819)所示。

**图 2**  数据库备份流程图<a name="fig3947184273819"></a>  
![](figures/数据库备份流程图.png "数据库备份流程图")

1.  更改安全组：使用数据库备份前需要先更改云服务器的安全组。相关操作请参见[更改安全组](更改安全组.md)。
2.  安装agent：更改云服务器的安全组和在云服务器安装agent没有严格的先后顺序，在执行服务器备份前完成两项操作即可。相关操作请参见[安装Agent](安装Agent.md)。
3.  创建数据库备份：在备份服务器前创建数据库备份存储库后，绑定相应的云服务器，即可创建数据库备份。相关操作请参见[创建数据库服务器备份](创建数据库服务器备份.md)。
4.  修改或编写自定义脚本：在完成控制台上的数据库备份后，需要在云服务器中的数据库上修改或编写自定义脚本，才能完成数据库备份。相关操作请参见[通过自定义脚本实现一致性备份](https://support.huaweicloud.com/bestpractice-cbr/cbr_07_0002.html)。
5.  验证数据库备份结果：使用自定义脚本实现数据库备份后，可以通过操作验证数据库备份结果是否成功。相关操作请参见[验证数据库备份结果](https://support.huaweicloud.com/bestpractice-cbr/cbr_07_0014.html)。
6.  恢复服务器数据：可以使用备份恢复云服务器的数据，数据库应用和数据等将与备份时间点的数据保持一致。相关操作请参见[使用云服务器备份恢复数据](使用云服务器备份恢复数据.md)。

